---

- name: update yum
  yum: name=* state=latest

- name: install common tools
  yum: name={{ item }} state=installed
  with_items: "{{ common_packages }}"

- name: set up time zone symlink
  file:
    src: "{{ timezone_file }}"
    dest: /etc/localtime
    owner: root
    group: root
    state: link
  when: configure_ntpd

- name: configure ntp
  template: src=ntp.conf.j2 dest=/etc/ntp.conf
  notify:
    - restart ntpd
  tags: ntp
  when: configure_ntpd

- name: ensure ntp is running and enabled
  service: name=ntpd state=running enabled=yes
  tags: ntp
  when: configure_ntpd

- name: disable GSSAPIAuthentication for ssh login
  lineinfile:
    dest: "/etc/ssh/sshd_config"
    regexp: "^GSSAPIAuthentication"
    line: "GSSAPIAuthentication no"
    state: present
  notify: restart sshd
  ignore_errors: yes

- name: disable UseDNS for ssh login
  lineinfile:
    dest: "/etc/ssh/sshd_config"
    line: "UseDNS no"
    state: present
  notify: restart sshd
  ignore_errors: yes
